<div class="container pt-5" *ngIf="!Pay.AssessoratoDetail && !_loading">
  <div class="row mb-5">
    <div class="col-12">
      <pay-title-deco art-class="title-deco" [simple]="true" [titolo]="__title"></pay-title-deco>
    </div>
  </div>
  <div class="row mb-3">
    <div class="col-12">
      <mat-form-field class="w-100">
        <input #filtro matInput [placeholder]="Pay.I18n.json.Common.Filtro.Placeholder" [(value)]="__filterText" (keydown)="_keyDown($event)" autocomplete="off">
        <mat-icon class="icon-search" [ngClass]="filtro.value?'action':''" matSuffix (click)="__matFilterIcon(filtro)" aria-label="ricerca">{{ filtro.value?'close':'search' }}</mat-icon>
      </mat-form-field>
    </div>
  </div>
  <div class="row mb-5">
    <div class="" [ngClass]="{ 'col-12': !_showToggleLayout, 'col-9': _showToggleLayout }" *ngIf="_taxonomies && _showTaxonomies && !_isFlat">
      <button type="button" class="select-button mb-2 mr-3 text-truncate" [class.active]="isCurrentTaxonomy(_taxonomies.taxonomy1)" [class.w-100]="!Pay.SmBlock()" (click)="_setTaxonomy(_taxonomies.taxonomy1.id)" *ngIf="_taxonomies.taxonomy1">
        <span class="d-inline material-icons" *ngIf="_taxonomies.taxonomy1.image"><img class="icon-20" [src]="_taxonomies.taxonomy1.image"></span>
        <i class="material-icons mr-1" *ngIf="!_taxonomies.taxonomy1.image">{{ _taxonomies.taxonomy1.icon }}</i> 
        <span>Mostra {{ _taxonomies.taxonomy1.name }}</span></button>
      <button type="button" class="select-button text-truncate" [class.active]="isCurrentTaxonomy(_taxonomies.taxonomy2)" [class.w-100]="!Pay.SmBlock()" (click)="_setTaxonomy(_taxonomies.taxonomy2.id)" *ngIf="_taxonomies.taxonomy2">
        <span class="d-inline material-icons" *ngIf="_taxonomies.taxonomy2.image"><img class="icon-20" [src]="_taxonomies.taxonomy2.image"></span>
        <i class="material-icons mr-1" *ngIf="!_taxonomies.taxonomy2.image">{{ _taxonomies.taxonomy2.icon }}</i> 
        <span class="ml-2">Mostra {{ _taxonomies.taxonomy2.name }}</span></button>
    </div>
    <div class="col-sm-3 text-right" [ngClass]="{ 'offset-9': !(_taxonomies && _showTaxonomies && !_isFlat) }" *ngIf="_showToggleLayout">
      <mat-button-toggle-group name="_isFlat" aria-label="Flat Toggle" (change)="_toggleLayout($event)">
        <mat-button-toggle value="taxonomies" [checked]="!_isFlat"><mat-icon>account_tree</mat-icon></mat-button-toggle>
        <mat-button-toggle value="flat" [checked]="_isFlat"><mat-icon>remove</mat-icon></mat-button-toggle>
      </mat-button-toggle-group>
      <mat-button-toggle-group class="ml-2" name="_isFlatGrid" aria-label="Flat Grid Toggle" (change)="_toggleFlatView($event)" *ngIf="_isFlat">
        <mat-button-toggle value="true" [checked]="_isFlatGrid"><mat-icon>view_module</mat-icon></mat-button-toggle>
        <mat-button-toggle value="false" [checked]="!_isFlatGrid"><mat-icon>view_list</mat-icon></mat-button-toggle>
      </mat-button-toggle-group>
    </div>
  </div>
  <div class="row" [class.mt-5]="_isFlat" [class.mx-0]="_isFlat && !_isFlatGrid" *ngIf="_servizi">
    <ng-container *ngIf="_isFlat && _isFlatGrid">
      <div class="col-6 quadro-servizio" [ngClass]="{ 'col-md-4': _smallView, 'col-md-3': !_smallView }" *ngFor="let item of _servizi[Pay.ALPHA_3_CODE].flat|serviceFilter:filtro.value:Pay.Filtri; let i = index">
        <pay-quadro-flat #psi
          [gruppo]="item.group"
          [titolo]="item.title"
          [meta]="_mapMetaData(item)"
          [source]="item"
          (click)="_onItemClick(item)">
        </pay-quadro-flat>
      </div>
    </ng-container>
    <ng-container *ngIf="_isFlat && !_isFlatGrid">
      <pay-group class="col-12 mx-auto" *ngFor="let gs of _servizi[Pay.ALPHA_3_CODE].groups|serviceGroupFilter:filtro.value:_servizi[Pay.ALPHA_3_CODE].dictionary:Pay.Filtri; let i = index"
        [groupIcon]="'group_work'" [groupImage]="_getTaxonomyImage(gs)" [title]="_getTaxonomyTitle(gs)" [count]="_showCounter ? gs.items.length : 0" [id]="i" [open]="true">
        <pay-simple-item #psi group-content *ngFor="let se of gs.items"
          [primaryText]="se.title"
          [metadata]="_mapMetaData(se)"
          (click)="_onItemClick(se)">
        </pay-simple-item>
        <p group-content class="m-0" *ngIf="gs.items.length === 0">{{Pay.I18n.json.Common.Filtro.NessunaCorrispondenza}}</p>
      </pay-group>
    </ng-container>
    <ng-container *ngIf="!_isFlat">
      <ng-template [ngIf]="!filtro?.value.trim()">
        <div class="col-6 quadro-servizio" [ngClass]="{ 'col-md-4': _smallView, 'col-md-3': !_smallView }" *ngFor="let qs of _servizi[Pay.ALPHA_3_CODE].groups; let i = index">
          <pay-quadro [quadro-class]="'quadro'" [logo-class]="'cover logo'" [titolo]="_getTaxonomyTitle(qs)" [source]="qs"
                      [image-src]="qs.backgroundSrc" (click)="_onQuadroClick(qs, i)"></pay-quadro>
        </div>
      </ng-template>
      <ng-template [ngIf]="filtro.value.trim()">
        <div class="col-12">
          <!--<pay-simple-item group-content *ngFor="let fs of _servizi[Pay.ALPHA_3_CODE].flat" [primaryText]="fs.category" (click)="_onGroupItemClick(fs)"></pay-simple-item>-->
          <pay-group *ngFor="let gs of _servizi[Pay.ALPHA_3_CODE].groups|serviceGroupFilter:filtro.value:_servizi[Pay.ALPHA_3_CODE].dictionary:Pay.Filtri; let i = index"
                    [groupIcon]="'group_work'" [groupImage]="gs.backgroundSrc" [title]="_getTaxonomyTitle(gs)" [id]="i" [open]="true">
            <pay-simple-item #psi group-content *ngFor="let se of gs.items" [primaryText]="se.title" [metadata]="_mapMetaData(se)" (click)="_onItemClick(se)"></pay-simple-item>
            <p group-content class="m-0" *ngIf="gs.items.length === 0">{{Pay.I18n.json.Common.Filtro.NessunaCorrispondenza}}</p>
          </pay-group>
        </div>
      </ng-template>
    </ng-container>
  </div>
</div>
<pay-servizi-assessorato *ngIf="Pay.AssessoratoDetail" [assessorato]="_assessorato" [tassonomia]="_currentTaxonomy" [tassonomia1]="_taxonomy1" [tassonomia2]="_taxonomy2" (on-close)="__closeAssessorato()"></pay-servizi-assessorato>
